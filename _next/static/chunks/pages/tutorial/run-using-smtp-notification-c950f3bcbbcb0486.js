(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[242],{4308:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tutorial/run-using-smtp-notification",function(){return t(3175)}])},3175:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return u},meta:function(){return s}});t(7294);var i=t(3905),o=t(8470);function a(e,n){if(null==e)return{};var t,i,o=function(e,n){if(null==e)return{};var t,i,o={},a=Object.keys(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var s={id:"run-using-smtp-notification",title:"Run using SMTP Notification"},r={meta:s},l=function(e){var n=e.children,t=a(e,["children"]);return(0,i.kt)(o.C,Object.assign({meta:s},t),n)};function u(e){var n=e.components,t=a(e,["components"]);return(0,i.kt)(l,Object.assign({},r,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"This tutorial will show you how to integrate Monika with SMTP so you can receive notifications from Monika straight to your email."),(0,i.kt)("h2",Object.assign({},{id:"configuring-the-smtp-notification-channel"}),"Configuring the SMTP notification channel",(0,i.kt)("a",Object.assign({parentName:"h2"},{href:"#configuring-the-smtp-notification-channel",title:"Direct link to heading",className:"anchor"}),(0,i.kt)("span",Object.assign({parentName:"a"},{className:"icon icon-link"})))),(0,i.kt)("p",null,"In order to start using Google Mail as your Monika notification channel, you need to prepare these:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"One Google Mail Account"),(0,i.kt)("li",{parentName:"ol"},"A Monika configuration"),(0,i.kt)("li",{parentName:"ol"},"Patience")),(0,i.kt)("p",null,"First, go to the ",(0,i.kt)("a",Object.assign({parentName:"p"},{href:"https://myaccount.google.com/lesssecureapps"}),"Less secure app access")," section of your Google Account. You might need to sign in first using your Google account. Then, turn on the \u201cAllow less secure apps\u201d like so:"),(0,i.kt)("img",Object.assign({},{src:"https://miro.medium.com/max/1400/1*9ZHBFLFw61-mXbQcIfjv1w.png",alt:null})),(0,i.kt)("p",null,"Now that we enabled the \u2018Allow less secure apps\u2019 option, it is time to create a Monika configuration. As an example, let\u2019s use a configuration from our previous article: ",(0,i.kt)("a",Object.assign({parentName:"p"},{href:"https://dennypradipta.medium.com/be-alerted-when-your-authentication-api-is-slow-with-monika-a-guide-for-chaining-request-a63801df8b39"}),"Be alerted when your authentication API is slow with Monika: A guide for chaining request")),(0,i.kt)("p",null,"The configuration above will hit the /login endpoint with a JSON request body and hit an API using the token from the previous request\u2019s response in the Authorization header. If you look closely in the notifications block, it only shows you desktop notifications when an alert is triggered. What we are going to do is to add a new notification channel, which is SMTP. Here is an example of an SMTP notification block:"),(0,i.kt)("pre",null,(0,i.kt)("code",Object.assign({parentName:"pre"},{}),"\\- id: unique-id-smtp\n  type: smtp\n  data:\n    recipients: \\[RECIPIENT\\_EMAIL\\_ADDRESS\\]\n    hostname: smtp.mail.com\n    port: 587\n    username: SMTP\\_USERNAME\n    password: SMTP\\_PASSWORD\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"ID: Notification channel unique ID"),(0,i.kt)("li",{parentName:"ul"},"Type: Notification type (e.g ",(0,i.kt)("inlineCode",{parentName:"li"},"smtp"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"desktop"),", etc.)"),(0,i.kt)("li",{parentName:"ul"},"Recipients: An array of email addresses that will receive the e-mail from Monika (e.g ",(0,i.kt)("inlineCode",{parentName:"li"},'["monika@gmail.com", "symon@gmail.com"]')," )"),(0,i.kt)("li",{parentName:"ul"},"Hostname: The SMTP host that you will use for sending the email, in this case ",(0,i.kt)("inlineCode",{parentName:"li"},"smtp.gmail.com")," as we are going to be using Google Mail SMTP"),(0,i.kt)("li",{parentName:"ul"},"Port: The port allowed to be used for sending mail in your SMTP host. Google Mail suggested that we use port ",(0,i.kt)("inlineCode",{parentName:"li"},"465")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"587")),(0,i.kt)("li",{parentName:"ul"},"Username: Your SMTP username. Use your existing Google Mail email address"),(0,i.kt)("li",{parentName:"ul"},"Password: Your SMTP password. Use your existing Google Mail password. If you have activated 2-Factor-Authentication (2FA), you need to ",(0,i.kt)("a",Object.assign({parentName:"li"},{href:"https://support.google.com/accounts/answer/185833"}),"create an App Password from your Account Settings")," and then use the app password.")),(0,i.kt)("p",null,"Now that we know the structure of the SMTP notification block, it\u2019s time to update our Monika configuration:"),(0,i.kt)("pre",null,(0,i.kt)("code",Object.assign({parentName:"pre"},{}),'notifications:\n  - id: unique-id-smtp\n    type: smtp\n    data:\n      recipients: ["recipient-1@example.com", "recipient-2@example.com"]\n      hostname: smtp.gmail.com\n      port: 587\n      username: denny@example.com\n      password: p455w0rd\nprobes:\n  - id: sample_login\n    name: Sample Login\n    requests:\n      - method: POST\n        url: https://reqres.in/api/login\n        body:\n          email: "eve.holt@reqres.in"\n          password: "cityslicka"\n        headers:\n          Content-Type: application/json\n        alerts:\n          - query: response.time > 600\n            message: Login API Response time is {{ response.time }} ms, expecting less than 60>\n          - query: response.status != 200\n            message: Login API Status code is not 200. Please check the service status!\n      - method: GET\n        url: https://reqres.in/api/users/2\n        headers:\n          Authorization: Bearer {{ response.[0].data.token }}\n        alerts:\n          - query: response.time > 500\n            message: Get User API Response time is {{ response.time }} ms, expecting less than>\n          - query: response.status != 200\n            message: Get User API Status code is not 200. Please check the service status!\n    alerts:\n      - query: response.time > 10000\n        message: Please check your internet connection\n')),(0,i.kt)("p",null,"Save the configuration file as ",(0,i.kt)("inlineCode",{parentName:"p"},"monika.yml")," and run the configuration. When an alert is triggered, it should send a recovery or incident email to the recipients you have configured."),(0,i.kt)("img",Object.assign({},{src:"https://miro.medium.com/max/1400/1*6PDFNfQV7AYkPMO97hAT2g.png",alt:null})),(0,i.kt)("p",null,"Congratulations! You can now send the alert notification using Google Mail SMTP!"))}u.isMDXComponent=!0}},function(e){e.O(0,[547,778,470,774,888,179],(function(){return n=4308,e(e.s=n);var n}));var n=e.O();_N_E=n}]);